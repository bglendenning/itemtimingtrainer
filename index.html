<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="author" content="Brandan Glendenning">
    <meta name="description" content="Arena shooter item timing trainer.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Arena Shooter Item Timing Trainer</title>

    <link rel="icon" href="data:,">

    <style>
      :root {
        --color-yellow: #f5bc6c;
        --color-green: #5f8258;
        --color-red: #c95b51;
        --color-blue: #5a70a0;
        --color-white: #fff7eb;
        --color-grey: #808080;
      }

      body {
        background-color: #010101;
        color: #fff7eb;
        font-family: sans-serif;
      }

      a {
        color: #5a70a0;
        text-decoration: none;
      }

      .item {
        color: #010101;
        cursor: pointer;
        font-weight: bold;
        height: 80px;
        width: 80px;
        margin: 0 20px 0 20px;
        padding: 10px;
      }

      .item:hover, #targetObject:hover, a:hover {
        opacity: 0.8;
      }

      #log {
        border-left: 1px #fff7eb dotted;
        margin: 40px auto 0 auto;
        padding-left: 20px;
        width: 600px;
      }

      #log h1 {
        font-size: 1em;
      }

      #clearLogs {
        margin-top: 20px;
      }

      #logs {
        height: 300px;
        margin: 20px auto 0 auto;
        overflow: auto;
      }

      #targetForm {
        margin-top: 20px;
        text-align: center;
      }

      #target {
        background-color: #5f8258;
        cursor: pointer;
        position: absolute;
        z-index: 1;
      }

      #timer {
        font-size: 50px;
        padding: 0 0 10px 0;
      }

      #items {
        display: flex;
        flex-flow: row wrap;
        justify-content: center;
      }

      #timerDisplay, #timerAdmin {
        text-align: center;
      }

      .color-yellow {
        color: var(--color-yellow);
      }

      .color-green {
        color: var(--color-green);
      }

      .color-red {
        color: var(--color-red);
      }

      .color-blue {
        color: var(--color-blue);
      }

      .color-white {
        color: var(--color-white);
      }

      .color-grey {
        color: var(--color-grey);
      }

      .background-color-yellow {
        background-color: var(--color-yellow);
      }

      .background-color-green {
        background-color: var(--color-green);
      }

      .background-color-red {
        background-color: var(--color-red);
      }

      .background-color-blue {
        background-color: var(--color-blue);
      }

      .background-color-white {
        background-color: var(--color-white);
      }

      .background-color-grey {
        background-color: var(--color-grey);
      }
    </style>
  </head>

  <body>
    <div id="target"></div>
    <div id="timer">
      <div id="timerAdmin">
        <a href="javascript:void(0)" id="timerStart">start</a>
        <a href="javascript:void(0)" id="timerStop">stop</a>
        <a href="javascript:void(0)" id="timerReset">reset</a>
        <a href="javascript:void(0)" id="timerMultiplierDecrease">-</a>
        <a href="javascript:void(0)" id="timerMultiplierIncrease">+</a>
      </div>

      <div id="timerDisplay">
        <span id="timerClock">00:00</span>
        <span id="timerMultiplier">1x</span>
      </div>
    </div>

    <div id="items"></div>

    <div id="targetForm">
      <label><input type="checkbox" id="targetToggle"> Enable randomized target.</label>
    </div>

    <div id="log">
      <div>High Score: <span id="scoreHigh">0000000000</span></div>

      <div>Session Score: <span id="scoreSession">0000000000</span></div>

      <div id="logs">
        <p>
          Click <strong>Start</strong> to start the timer. While the timer is active, click the
          colored squares to earn points. Each square displays a number indicating how many seconds
          you must wait to register a new click for that item. A registered click is worth the
          square's indicated value multiplied by the timescale. <strong>-</strong> &
          <strong>+</strong> can be used to manipulate the rate at which the timer accrues. Click
          <strong>Stop</strong> to stop the timer, and <strong>Reset</strong> to stop the timer, set
          the session score to 0, and set the target position to the top-left corner of the browser
          window.
        </p>

        <p>
          Check <strong>Enable randomized target</strong> to make the target visible. Each target
          clicked is worth 1 point multiplied by the timescale.
        </p>
      </div>

      <div>
        <a id="clearLogs" href="javascript:void(0)">Clear Logs</a>
      </div>
    </div>

    <script type="text/javascript">
      function pad(value, length) {
        let valueString = value.toString();

        while (valueString.length < length) {
          valueString = "0" + valueString;
        }

        return valueString;
      }

      class Logger {
        constructor() {
          // DOM elements
          this.elements = {
            logs: document.getElementById("logs"),
            clear: document.getElementById("clearLogs"),
          };

          // Event listeners
          this.elements.clear.addEventListener("click", this.clearElementClick);
        }

        createLogEntry(content, color) {
          const paragraphElement = document.createElement("p");
          paragraphElement.textContent = `${timer.formatTime()} - ${content}`;
          paragraphElement.classList.add(color);
          this.elements.logs.prepend(paragraphElement);
        }

        clearElementClick = () => {
          this.elements.logs.textContent = "";
        }
      }

      class Score {
        constructor() {
          // DOM elements
          this.elements = {
            session: document.getElementById("scoreSession"),
            high: document.getElementById("scoreHigh"),
            multiplier: document.getElementById("scoreMultiplier")
          };

          // Event listeners
          timer.elements.reset.addEventListener("click", () => this.session = 0);

          // Default values
          this.high = 0;
          this.session = 0;
          this.length = 10;

          this.updateHighElementText();
          this.updateSessionElementText();
        }

        #high = 0;

        get high() {
          return this.#high;
        }

        set high(score) {
          this.#high = score;
        }

        updateHighElementText() {
          this.elements.session.textContent = pad(this.session, this.length);
        }

        #session = 0;

        get session() {
          return this.#session;
        }

        set session(points) {
          this.#session = points
          this.elements.session.textContent = pad(this.session, this.length);

          if (this.#session > this.high) {
            this.high = this.#session;
            this.elements.high.textContent = pad(this.high, this.length);
          }
        }

        addPointsToSession(points) {
          this.session += points * timer.multiplier
        }

        updateSessionElementText() {
          this.elements.session.textContent = pad(this.session, this.length);
        }
      }

      class Target {
        constructor() {
          // DOM elements
          this.elements = {
            target: document.getElementById("target"),
            targetToggle: document.getElementById("targetToggle"),
          };
          this.elements.target.style.left = `${this.targetElementLeft}px`;
          this.elements.target.style.top = `${this.targetElementTop}px`;
          this.elements.target.style.width = `${this.targetElementWidth}px`;
          this.elements.target.style.height = `${this.targetElementHeight}px`;
          this.targetElementVisibility = this.elements.targetToggle;
          this.elements.target.style.visibility = this.targetElementVisibility;

          // Event listeners
          this.elements.target.addEventListener("click", this.targetElementClick);
          this.elements.targetToggle.addEventListener("click", this.targetToggleElementClick);
          timer.elements.reset.addEventListener("click", this.resetTargetElementPosition);
          timer.elements.reset.addEventListener("click", this.resetTargetElementDimensions);
        }

        #targetElementLeft = 50; // Pixels

        get targetElementLeft() {
          return this.#targetElementLeft;
        }

        set targetElementLeft(left) {
          this.#targetElementLeft = left;
        }

        #targetElementTop = 50; // Pixels

        get targetElementTop() {
          return this.#targetElementTop;
        }

        set targetElementTop(top) {
          this.#targetElementTop = top;
        }

        #targetElementWidth = 25; // Pixels

        get targetElementWidth() {
          return this.#targetElementWidth;
        }

        set targetElementWidth(width) {
          this.#targetElementWidth = width;
        }

        #targetElementHeight = 25; // Pixels

        get targetElementHeight() {
          return this.#targetElementHeight;
        }

        set targetElementHeight(height) {
          this.#targetElementHeight = height;
        }

        #targetElementVisibility = "hidden"

        get targetElementVisibility() {
          return this.#targetElementVisibility;
        }

        set targetElementVisibility(element) {
          this.#targetElementVisibility = element.checked ? "visible" : "hidden";
        }

        updateTargetElement() {
          this.elements.target.style.left = `${this.targetElementLeft}px`;
          this.elements.target.style.top = `${this.targetElementTop}px`;
          this.elements.target.style.width = `${this.targetElementWidth}px`;
          this.elements.target.style.height = `${this.targetElementHeight}px`;
          this.elements.target.style.visibility = this.targetElementVisibility;
        }

        resetTargetElementPosition = () => {
          this.targetElementLeft = 50;
          this.targetElementTop = 50;
          this.updateTargetElement();
        }

        resetTargetElementDimensions = () => {
          this.targetElementWidth = 25;
          this.targetElementHeight = 25;
          this.updateTargetElement();
        }

        setRandomTargetElementPosition() {
          const maxLeft = window.innerWidth - this.targetElementWidth - 50;
          const maxTop = window.innerHeight - this.targetElementHeight - 50;
          this.targetElementLeft = Math.floor((Math.random() * maxLeft) + 50);
          this.targetElementTop = Math.floor((Math.random() * maxTop) + 50);
          this.updateTargetElement();
        }

        targetElementClick = (event) => {
          event.stopPropagation();

          if (timer.interval && this.elements.targetToggle.checked) {
            this.setRandomTargetElementPosition();
            score.addPointsToSession(1);
          }
        }

        targetToggleElementClick = (event) => {
          this.targetElementVisibility = event.target;
          this.updateTargetElement();
        }
      }

      class Timer {
        constructor() {
          // DOM elements
          this.elements = {
            clock: document.getElementById("timerClock"),
            start: document.getElementById("timerStart"),
            stop: document.getElementById("timerStop"),
            reset: document.getElementById("timerReset"),
            multiplier: document.getElementById("timerMultiplier"),
            multiplierDecrease: document.getElementById("timerMultiplierDecrease"),
            multiplierIncrease: document.getElementById("timerMultiplierIncrease"),
          };
          this.updateClockElementText();

          // Event listeners
          this.elements.start.addEventListener("click", this.startElementClick);
          this.elements.stop.addEventListener("click", this.stopElementClick);
          this.elements.reset.addEventListener("click", this.resetElementClick);
          this.elements.multiplierDecrease.addEventListener("click", this.multiplierDecreaseElementClick);
          this.elements.multiplierIncrease.addEventListener("click", this.multiplierIncreaseElementClick);
        }

        #seconds = 0;

        get seconds() {
          return this.#seconds;
        }

        set seconds(seconds) {
          this.#seconds = seconds;
        }

        #interval = null;

        get interval() {
          return this.#interval;
        }        

        set interval(interval) {
          clearInterval(this.interval);

          if (interval) {
            this.#interval = setInterval(() => {
              this.seconds += 1;
              this.updateClockElementText();
            }, (1000 / this.multiplier));
          } else {
            this.#interval = null;
          }
        }

        #multiplier = 1;

        get multiplier() {
          return this.#multiplier;
        }

        set multiplier(multiplier) {
          if (multiplier > 0) {
            this.#multiplier = multiplier;
          }
        }

        updateMultiplierElementText() {
          this.elements.multiplier.textContent = `${this.multiplier}x`;
        }

        formatTime() {
          const minutes = pad(Math.floor(this.seconds / 60), 2);
          let seconds;

          if (this.seconds >= 60) {
            seconds = pad(this.seconds % 60, 2);
          } else {
            seconds = pad(this.seconds, 2);
          }

          return `${minutes}:${seconds}`;
        }

        updateClockElementText() {
          this.elements.clock.textContent = this.formatTime();
        }

        startElementClick = () => {
          if (!this.interval) {
            this.interval = true;
          }
        }

        stopElementClick = () => {
          if (this.interval) {
            this.interval = false;
          }
        }

        resetElementClick = () => {
          if (this.interval) {
            this.interval = false;
          }

          this.seconds = 0;
          this.updateClockElementText();
        }

        multiplierDecreaseElementClick = () => {
          this.multiplier -= 1;
          this.updateMultiplierElementText();

          if (this.interval) {
            this.interval = true;
          }
        }

        multiplierIncreaseElementClick = () => {
          this.multiplier += 1
          this.updateMultiplierElementText();

          if (this.interval) {
            this.interval = true;
          }
        }
      }

      class Items {
        constructor() {
          this.items = [
            {
              presentationName: "Red Armor",
              domElementId: "itemArmorRed",
              spawnIntervalSeconds: 25,
              spawnTimeSeconds: 0,
              backgroundColorClass: "background-color-red",
              logTextColor: "color-red"
            },
            this.items = {
              presentationName: "Yellow Armor",
              domElementId: "itemArmorYellow",
              spawnIntervalSeconds: 25,
              spawnTimeSeconds: 0,
              backgroundColorClass: "background-color-yellow",
              logTextColor: "color-yellow"
            },
            this.items = {
              presentationName: "Megahealth",
              domElementId: "itemHealthMega",
              spawnIntervalSeconds: 35,
              spawnTimeSeconds: 0,
              backgroundColorClass: "background-color-blue",
              logTextColor: "color-blue"
            },
          ];

          // DOM elements
          this.elements = {
            items: document.getElementById("items"),
          }

          // Create DOM elements from `this.items`
          this.items.forEach((item) => {
            const element = document.createElement("div");
            element.setAttribute("id", item.domElementId);
            element.setAttribute("data-spawn-interval-seconds", item.spawnIntervalSeconds);
            element.classList.add("item", item.backgroundColorClass);
            element.textContent = item.spawnIntervalSeconds;
            this.elements.items.append(element);
          });

          // Event listeners
          timer.elements.reset.addEventListener("click", this.resetElementClick);

          this.items.forEach((item) => {
            const element = document.getElementById(item.domElementId);
            element.addEventListener("click", this.itemElementClick);
          });
        }

        #items = []

        get items() {
          return this.#items;
        }

        set items(items) {
          this.#items = items;
        }

        itemElementClick = (event) => {
          if (timer.interval) {
            const item = this.items.find((item) => item.domElementId === event.target.getAttribute("id"));
            const difference = timer.seconds - item.spawnTimeSeconds;

            if (difference >= 0) {
              item.spawnTimeSeconds = timer.seconds + item.spawnIntervalSeconds;
              score.addPointsToSession(item.spawnIntervalSeconds);
              logger.createLogEntry(
                `${item.presentationName} picked up ${difference} seconds after spawn`,
                item.logTextColor
              );
            } else {
              logger.createLogEntry(
                `${item.presentationName} pick-up attempted ${Math.abs(difference)} seconds before spawn`,
                "grey"
              );
            }
          }
        }

        resetElementClick = () => {
          const items = [...this.items];

          items.forEach((item) => {
            item.spawnTimeSeconds = 0;
          });

          this.items = items;
        }
      }

      const logger = new Logger();
      const timer = new Timer();
      const score = new Score();
      const target = new Target();
      const items = new Items();
    </script>
  </body>
</html>
